#+title: Incremental informational value of floorplans for rent price prediction
#+SUBTITLE: Applications of modern computer vision techniques in real-estate
#+Bibliography: local-bib.bib
#+BEAMER_FRAME_LEVEL: 2
#+OPTIONS: H:4 toc:1 num:nil
#+EMAIL:     jiyan.schneider@keio.jp
#+AUTHOR: Jiyan Schneider* and Takahiro Hoshino*
#+OPTIONS: reveal_history:t reveal_fragmentinurl:t

:REVEAL_PROPERTIES:
#+REVEAL_TITLE_SLIDE: <h1>%t</h1><br><h2>%s</h2><br><h4>%a</h4><br>*Keio University, Graduate school of Economics <br> *RIKEN AIP
#+REVEAL_ROOT: ./reveal.js/
#+REVEAL_EXTRA_CSS: custom.css
#+REVEAL_THEME: serif
#+REVEAL_TRANS: linear
#+REVEAL_HLEVEL: 1

:END:

* Abstract
 - Exploratory study to examine whether floorplans could be analyzed to assist real estate predictions and research
 - real estate data collected from a publicly available website
 - Resnet model to predict rent prices using the floor plans images

* Introduction
** Background
#+BEGIN_NOTES
 - Real estate predictions are done in these contexts (SLIDE)
 - However while Price appraisal for Tax purposes etc is usually done on an individual basis by a certified person
 - In other use cases, real estate prices have to be estimated on larger scales (Governments, Banks etc.)
#+END_NOTES

 - Real estate rent/price prediction is needed in different situations in society
 - Price appraisal for tax purposes
 - Price estimations for government reporting purposes
 - Price estimation for investment purposes (individuals or firms)

*** Machine Learning in real estate
#+BEGIN_NOTES
 - [cite:@hattori2019rent] use PCA to extract feature vectors from floorplans
   - They use it in various models
   - While they note slight improvements, they say that it is challenging to find merits for their improvements, because they are too small

#+END_NOTES
 - PCA to to extract feature vectors of floorplan data [cite:@hattori2019rent]
 - Computer Vision techniques for floorplans, however they are trying to detect the functionalities of the rooms [cite:@zeng2019deep]
 - The earliest example the author's could find of research being done to use NN's for rent price prediction  from 2004 [cite:@limsombunchai2004]
   - In this paper the authors argue for the usage of NN's in real-estate price prediction despite the hardships of their interpretation, simply due to their predictive power
*** Price structure of real estate
#+BEGIN_NOTES
Secondly I will provide some background on the research on the price structure of real estate
 - Hedonic meaning that their price is determined by the properties that make it up
#+END_NOTES

 - Real estate prices are usually considered Hedonic prices in economics
 - [cite:@rosen_1974_hedonic] say that in general the price structure of real estate is more complicated than doing a regular regression.
 - Factors making up real estate price can be divided into two categories
   - "Structural" and  "Environmental"

**** TODO Structural and Environmental Factors
#+BEGIN_NOTES
 - We think that most of these "structural" factors can be extracted from the floorplans
 - Add more examples to each side of this table
#+END_NOTES

| Structural                    | Environmental               |
|-------------------------------+-----------------------------|
| Apartment size                | Closest station             |
| Floor of apartment            | No of supermarkets          |
| Material used in construction | Distance to the city center |
| Floor layout                  |                             |

* Methodology
** Data
 - Snapshot of tabular and image data of real estate properties
 - Only includes properties from the Tokyo Metropolitan area
 - 140,000 observations, 3 categorical and 7 continuous features
 - Limit observations to Tokyo Metropolitan area to avoid having to deal with multiple markets

*** Floorplan examle
#+BEGIN_NOTES
Maybe say that we took the log of the price in 10000Yen units.
#+END_NOTES

#+CAPTION: An example of randomly chosen floorplans and the log of their rent prices.
[[./assets/rand_imgs.png]]

*** Other data

#+NAME: tab:var_explanation
#+CAPTION: Continuous Variables
#+ATTR_LATEX: :name tab:var_explanation :label tab:var_explanation
|--------------------+-----------------------------------------------------------------|
| Variable           | Explanation                                                     |
|--------------------+-----------------------------------------------------------------|
|--------------------+-----------------------------------------------------------------|
| Apt. Floor         | The floor the property is on                                    |
| Size in \(m^{2}\)  | Size of property in $m^2$                                       |
| Method             | How "Time to station" is measured (foot, bus, or car)           |
| Time to station    | No. minutes of taking "method" to the next station              |
| Age bldg.          | No. of years ago the property was built                         |
| No Floors bldg     | No of floors of the building                                    |
| Admin fee  10,000¥ | Amount of monthly administration fee                            |
| Station            | Name of the closest public transport station                    |
| Style              | Description of the layout type of the apartment (1K, 1LDK,... ) |
| apt_rent           | Rent per month of the listing. In units of 10000 Yen            |
|--------------------+-----------------------------------------------------------------|

** Neural Network Details
#+BEGIN_NOTES
 - scaling of the last layer is important for the model to converge
 - the model would put out predictions that are too high -> makes the gradients become big -> weight adjustments too big -> model diverges
 - Just scaling the outputs in the last layers is enough, but we now have a new hyperparameter with this y-range
 - We used Resnet50, because many models use this size, but again, we found that using a bigger model e.g. Resnet152 gave better results
 - We chose Resnet50 over newer models, because it is a well studied model
#+END_NOTES

 - used a ~Resnet50~ architecture [cite:@he15:deep_resid_learn_image_recog]
 - Weights were initialized to pretrained weights available from ~torchvision~
 - Randomly initialized fully connected layers at the end of the usual ~Resnet50~ model
 - Finally, we used a sigmoid function to scale the outputs of the very last layer
*** Preprocessing of Images
#+BEGIN_NOTES
 - We chose 224x224 because many image models use this size, we found that using bigger pictures gave better results
 - Cropping out of the image is done randomly as a augmentation technique
 - Image rotations were done at 90, 180, 270, 0 degree angles
 - We did not mirror the floorplans on purpose, as that would change the floorplans fundamentally ( Doors open the wrong ways, the compass shows the wrong direction )
#+END_NOTES

 - Normalization of images with normalization statistics of pretrained dataset
 - Two augmentation steps were also implemented
 - Randomly rotating the images
 - randomly cropping out a 224x224 square of the image


*** Resizing Methods
#+BEGIN_NOTES
In this picture we can see two other resizing techniques often used
 - Distortion
 - Center cropping
 - Distorting is bad because it distorts the proportions of the floor plan, making it another floorplan all together
 - Center cropping is bad because we might crop off important parts of the image
#+END_NOTES

#+CAPTION: Properties of different resizing methods
[[file:./assets/resizes.jpg]]

* Results
 - When training the Neural network we split the data into a train and test set.
 - The above splits

 were performed on the building level (as opposed to the apartment level)
 - This was done to make sure that the NN doesn't simply remember the style of floorplans of certain buildings

** Quantiative
*** TODO Models
#+BEGIN_NOTES
 - NN Factor is is the output of the NN based on the floorplans seen.
 - Model estimated on data as a whole
#+END_NOTES

#+ATTR_HTML: :height 500px
#+CAPTION: Regression table of the 3 estimated models (categorical features omitted).
[[./assets/model_table.jpg]]

*** Performance
#+NAME: tab:regression
#+LABEL: tab:regression
#+CAPTION: \( R^2 \) and sample size for the three models obtained on different parts of the dataset.
#+ATTR_LATEX: :label tab:regression :name tab:regression
|--------------------------------------+---------+---------+--------|
|                                      |   total |   train |   test |
|--------------------------------------+---------+---------+--------|
| Model 1:  \( R^{2} \) MLR Without NN |   0.915 |   0.915 |  0.914 |
| Model 2: \( R^{2} \) MLR With NN     |   0.945 |   0.951 |  0.923 |
| Model 3: \( R^{2} \) LR NN only      |   0.897 |   0.917 |  0.817 |
| N                                    | 141,394 | 113,116 | 28,278 |
|--------------------------------------+---------+---------+--------|

** Discussion and critique of the Neural Network
 - In this section we will have a look at some predictions the model makes qualitatively
 - This is done to find out about some of the weaknesses of the model
 - First we look at some normal predictions, and afterwards at some extremes
   - Furthermore, we can see that the NN is overfitting slightly
 - The problem of having to deal with multiple markets has to be addressed
*** Qualitative look at predictions
 - In this section we will have a look at some predictions the model makes
 - First we look at some normal predictions, and afterwards at some extremes
 - This is done to find out about some of the weaknesses of the model
 - Here, we will look some more into the mistakes in predictions that the NN is making
**** Randomly Extracted sample
#+CAPTION: NN predictions and ground truths for a randomly extracted sample of the dataset. (in 10,000¥)
[[./assets/random_table.png]]

**** Lowest predictions of the neural net
#+BEGIN_NOTES
 - All of the lowest predictions are of single room apartments in dormitories
 - The model probably picked up on the repetitive nature of these floorplans
 - thus knows to predict these apartments to have lower rents
 - The middle 2 pics are actually the same, but predictions are different ( Due to random cropping )


#+END_NOTES

#+CAPTION: The four predictions the model predicted the lowest rent for. (in 10,000¥)
[[./assets/rand_neg_top_100.png]]

**** Highest predictions of the neural net
#+BEGIN_NOTES
 - The highest predictions all have multiple bed rooms
 - Multiple floors
 - complicated layouts
 - The magnitude of the overpredictions is quite high ()
#+END_NOTES


#+CAPTION: The floorplans of the four apartments with the highest predicted rents. (in 10,000¥)
[[./assets/rand_top_100.png]]

**** Largest decreases in Regression prediction after including NN output
#+CAPTION: Floorplans of apartments with the biggest decreases in predicted rent due to NN output (in 10,000¥)
[[./assets/overpreds.png]]

**** TODO Largest increases
#+CAPTION: Floorplans of apartments with the biggest increases in predicted rent due to NN output (in 10,000¥)
[[./assets/underpreds.png]]

* Conclusion
 - Used real estate data collected from a publicly available website
 - Trained a Resnet model to predict rent prices using the floor plans images
 - Slightly modified the ResNet to allow for faster convergence
 - We were able to improve the accuracy of existing methods from \( R^2 = 0.915\) to \( R^2  = 0.945 \)
 - In further research we hope to obtain more apartment level features to see whether the NN captures these features

* Bibliography
:PROPERTIES:
:CUSTOM_ID:bibliography
:END:
#+print_bibliography:
